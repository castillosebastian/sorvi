\VignetteEngine{knitr::knitr}
\VignetteIndexEntry{sorvi Markdown Vignette made with knitr}

<!--
Joissakin esimerkeissa tarvittavat riippuvuudet 
	<a href="http://trac.osgeo.org/gdal/wiki/DownloadSource">GDAL</a>, 
	<a href="http://freeglut.sourceforge.net/">freeglut</a>, 
	<a href="http://xmlsoft.org/downloads.html">XML</a>, 
	<a href="http://trac.osgeo.org/geos">GEOS</a> ja 
	<a href="http://trac.osgeo.org/proj">PROJ.4</a>. 

-->

Finnish open government data toolkit for R
===========

sorvi provides miscellaneous tools for Finnish open government data to
complement other [rOpenGov](http://ropengov.github.io/projects)
packages with a more specific scope. We also maintain a [todo
list of further data sources](https://github.com/rOpenGov/sorvi/blob/master/vignettes/todo-datasets.md) to be added; your
[contributions are
welcome](http://louhos.github.com/contact.html). For further
information, see the [home page](http://louhos.github.com/sorvi).


### Available data sources and tools

 * [Installation](#installation) (Asennus)
 * [Finnish population register](#populationregister) (Vaestorekisteri)
 * [Finnish postal codes](#postalcodes) (Postinumerodata)
 * [Finnish municipalities](#municipality) (Kuntatason informaatio)
 * [Finnish provinces](#provinces) (Maakuntatason informaatio)
 * [Translations](#translations) (Suomi-Englanti-kaannoksia)
 * [IP address geographic coordinates](#ip) (IP-osoitteen koordinaatit)
 * [Finnish personal identification number (HETU)](#hetu) (Henkilotunnuksen kasittely)
 * [Visualization tools](#visualization) (Visualisointirutiineja)


### <a name="installation"></a>Installation

We assume you have installed [R](http://www.r-project.org/). If you
use [RStudio](http://www.rstudio.com/ide/download/desktop), change the
default encoding to UTF-8. Linux users should also install
[CURL](http://curl.haxx.se/download.html).

Install the stable release version in R:

```{r install, eval=FALSE}
install.packages("sorvi")
```

Test the installation by loading the library:

```{r test, eval=FALSE}
library(sorvi)
```

We also recommend setting the UTF-8 encoding:

```{r locale, eval=FALSE}
Sys.setlocale(locale="UTF-8") 
```

Brief examples of the package tools are provided below. Further
examples are available in [Louhos-blog](http://louhos.wordpress.com)
and in our [Rmarkdown blog](http://louhos.github.io/archive.html).

### <a name="populationregister"></a>Finnish population register

Municipality-level population information from [Finnish population register](http://vrk.fi/default.aspx?docid=5127&site=3&id=0) (Vaestokeskus): 

```{r popreg, message=FALSE, eval=TRUE}
df <- get_population_register()
head(df)
```


### <a name="postalcodes"></a>Postal codes

Finnish postal codes vs. municipalities table from
[Wikipedia](http://fi.wikipedia.org/wiki/Luettelo_Suomen_postinumeroista_kunnittain). The
municipality names are provided also in plain ascii without special
characters:

```{r postalcodes, message=FALSE, warning=FALSE, eval=TRUE}
postal.code.table <- get_postal_code_info() 
head(postal.code.table)
```



### <a name="municipality"></a>Municipality data

Finnish municipality information is available through Population
Registry (Vaestorekisterikeskus), Statistics Finland (Tilastokeskus)
and Land Survey Finland (Maanmittauslaitos). The row names for each
data set are harmonized and can be used to match data sets from
different sources, as different data sets may carry slightly different
versions of certain municipality names. 

**Land Survey Finland municipality information** ([Maanmittauslaitos, MML](http://www.maanmittauslaitos.fi/aineistot-palvelut/latauspalvelut/avoimien-aineistojen-tiedostopalvelu)). 

```{r municipalityMML, message=FALSE, warning=FALSE, eval=TRUE}
municipality.info.mml <- get_municipality_info_mml()
municipality.info.mml[1:2,]
```

**Statistics Finland municipality information** ([Tilastokeskus](http://pxweb2.stat.fi/Database/Kuntien%20perustiedot/Kuntien%20perustiedot/Kuntaportaali.px))

```{r municipalityStatFi, message=FALSE, warning=FALSE, eval=TRUE}
library(pxR) # can be installed with install.packages("pxR")
library(reshape) # can be installed with install.packages("reshape")
municipality.info.statfi <- get_municipality_info_statfi()
municipality.info.statfi[1:2,]
```


**List the province for each municipality in Finland:**
```{r province2, message=FALSE, warning=FALSE, echo=TRUE, eval=TRUE}
# All municipalities
m2p <- municipality_to_province() 
head(m2p) # Just show the first ones

# Selected municipalities
municipality_to_province(c("Helsinki", "Tampere", "Turku")) 

# Speeding up with predefined municipality info table:
m2p <- municipality_to_province(c("Helsinki", "Tampere", "Turku"), municipality.info.mml)
head(m2p)
```

**Convert municipality codes and names** (see
help(convert_municipality_codes) for all options):

```{r province3, message=FALSE, echo=TRUE, eval=TRUE}
# Municipality name to code
convert_municipality_codes(municipalities = c("Turku", "Tampere"))

# Municipality codes to names
convert_municipality_codes(ids = c(853, 837))

# Complete conversion table
municipality_ids <- convert_municipality_codes()
head(municipality_ids) # just show the first entries
```


### <a name="provinces"></a>Province information

Get Finnish province information from [Wikipedia](http://fi.wikipedia.org/wiki/V%C3%A4est%C3%B6tiheys):

```{r municipality, message=FALSE, eval=TRUE}
tab <- get_province_info_wikipedia()
head(tab)
```

### <a name="translations"></a>Translations

**Finnish-English translations** for province names (we have not been able
to solve all encoding problems yet; suggestions very welcome!):

```{r translate, message=FALSE, eval=TRUE}
translations <- load_sorvi_data("translations")
head(translations)
```


### <a name="ip"></a>IP Location

Geographic coordinates for a given IP-address from
[Data Science Toolkit](http://www.datasciencetoolkit.org/):

```{r iplocation, message=FALSE, eval=TRUE}
ip_location("137.224.252.10")
```

### <a name="hetu"></a>Personal identification number (HETU)

Extract information from a Finnish personal identification number:

```{r hetu, message=FALSE}
library(sorvi)
hetu("111111-111C")
```

Validate Finnish personal identification number:

```{r hetu2, fig.message=FALSE}
valid_hetu("010101-0101") # TRUE/FALSE
```



### <a name="visualization"></a>Visualization tools

Line fit with confidence smoothers (if any of the required libraries
are missing, install them with the install.packages command in R):

```{r regressionline, message=FALSE, eval=TRUE, fig.width=10, fig.height=5}
library(sorvi) 
library(plyr)
library(RColorBrewer)
library(reshape)
library(ggplot2)
data(iris)
p <- regression_plot(Sepal.Length ~ Sepal.Width, iris) 
print(p)
```




## Licensing and Citations

This work can be freely used, modified and distributed under the 
[Two-clause BSD license](http://en.wikipedia.org/wiki/BSD\_licenses).

Kindly cite the work as follows

```{r citation, message=FALSE, eval=TRUE}
citation("sorvi")
```

## Session info

This vignette was created with

```{r sessioninfo, message=FALSE, warning=FALSE}
sessionInfo()
```




